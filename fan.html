<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可交互3D电风扇 - Three.js Demo</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; font-family: sans-serif; }
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 200px;
        }
        h2 { margin-top: 0; font-size: 18px; color: #333; }
        .btn-group { margin-bottom: 15px; }
        button {
            width: 100%;
            padding: 10px;
            margin-bottom: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-on { background-color: #4CAF50; color: white; }
        .btn-off { background-color: #f44336; color: white; }
        .btn-action { background-color: #2196F3; color: white; }
        button:hover { opacity: 0.8; }
        input[type=range] { width: 100%; }
        label { font-size: 14px; color: #666; display: block; margin-bottom: 5px;}
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="controls">
        <h2>电风扇控制台</h2>
        
        <div class="btn-group">
            <button id="togglePower" class="btn-on">开启电源</button>
        </div>

        <div class="btn-group">
            <label>风速: <span id="speedVal">1</span></label>
            <input type="range" id="speedControl" min="1" max="10" value="1">
        </div>

        <div class="btn-group">
            <button id="toggleSwing" class="btn-action">摇头: 关</button>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- 1. 场景初始化 ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xe0e0e0);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 15, 30);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // 开启阴影
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- 2. 灯光 ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- 3. 构建风扇模型 (使用简单的几何体组合) ---
        
        // 材质
        const materialWhite = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.5 });
        const materialGrey = new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 0.2, metalness: 0.5 });
        const materialBlue = new THREE.MeshStandardMaterial({ color: 0x4aa3df, roughness: 0.2 });

        const fanGroup = new THREE.Group(); // 整个风扇
        const headGroup = new THREE.Group(); // 风扇头（用于摇头）
        const bladesGroup = new THREE.Group(); // 扇叶组（用于旋转）

        // A. 底座
        const baseGeo = new THREE.CylinderGeometry(4, 4.5, 0.5, 32);
        const base = new THREE.Mesh(baseGeo, materialWhite);
        base.position.y = 0.25;
        base.receiveShadow = true;
        fanGroup.add(base);

        // B. 立柱
        const poleGeo = new THREE.CylinderGeometry(0.8, 0.8, 10, 16);
        const pole = new THREE.Mesh(poleGeo, materialWhite);
        pole.position.y = 5.25;
        pole.castShadow = true;
        fanGroup.add(pole);

        // C. 电机/头部外壳
        const motorGeo = new THREE.CylinderGeometry(1.5, 1.5, 3, 16);
        const motor = new THREE.Mesh(motorGeo, materialWhite);
        motor.rotation.x = Math.PI / 2;
        headGroup.add(motor);
        
        // 连接杆
        const neckGeo = new THREE.CylinderGeometry(0.5, 0.5, 2, 12);
        const neck = new THREE.Mesh(neckGeo, materialGrey);
        neck.position.y = -1.5;
        headGroup.add(neck);

        // D. 扇叶 (创建3片)
        const bladeGeo = new THREE.BoxGeometry(1.2, 6, 0.2);
        bladeGeo.translate(0, 3, 0); // 调整中心点，使其围绕一端旋转

        for(let i = 0; i < 3; i++) {
            const blade = new THREE.Mesh(bladeGeo, materialBlue);
            blade.rotation.z = (i * 2 * Math.PI) / 3; // 120度分布
            blade.rotation.x = 0.3; // 攻角（让它看起来像扇叶）
            blade.castShadow = true;
            bladesGroup.add(blade);
        }
        bladesGroup.position.z = 1.6; // 放在电机前面
        
        // 扇叶中心盖子
        const capGeo = new THREE.CylinderGeometry(0.5, 0.8, 0.5, 16);
        const cap = new THREE.Mesh(capGeo, materialGrey);
        cap.rotation.x = Math.PI / 2;
        cap.position.z = 1.8;
        bladesGroup.add(cap);

        // 组装层级
        headGroup.add(bladesGroup);
        headGroup.position.y = 10.5; // 放在立柱顶端
        fanGroup.add(headGroup);
        
        scene.add(fanGroup);

        // 地板
        const floorGeo = new THREE.PlaneGeometry(50, 50);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
